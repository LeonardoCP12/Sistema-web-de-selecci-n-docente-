{% extends "base.html" %} {% load static %} {% block content %}
<link rel="stylesheet" href="{% static 'listar_docentes.css' %}" />

<nav class="breadcrumb__wrapper">
  <ol class="breadcrumb__list">
    <li class="breadcrumb__item"><a href="/home">Inicio</a></li>
    <li class="breadcrumb__item"><a>Listar Docentes</a></li>
  </ol>
</nav>
<section class="listar_docentes__wrapper relative">
  <div class="relative">
    <h1 class="title-base">
      Lista de docentes
      {% if titulo %}
        del curso {{ titulo }}
      {% endif %}
    </h1>
  <form method="get" action="" class="listar_docentes__curso">
    <button type="submit" class="button--primary">Buscar</button>
    <label for="curso-input" class="input-primary">
      <input list="cursos-list" id="curso-input" name="cod_curso_display" placeholder="Seleccionar curso" autocomplete="off" />
      <datalist id="cursos-list">
        {% for curso in cursos %}
          <option data-codigo="{{ curso.codigoCurso }}" value="{{ curso.nombreCurso }}"></option>
        {% endfor %}
      </datalist>
      <input type="hidden" id="cod_curso_real" name="cod_curso" />
    </label>
  </form>
  </div>
  <div class="tabla_docentes_container">
    <table border="1" id="tabla_docentes" class="table__primary">
      <thead>
        <tr>
          <th>Cod</th>
          <th>Apellido</th>
          <th>Nombres</th>
          <th>Facultad</th>
          <th>Curso</th>
          <th>Nota Evaluación Últimos dos Ciclos</th>
        </tr>
      </thead>
      <tbody>
        {% if mensaje %}
        <tr>
          <td>{{ mensaje }}</td>
        </tr>
        {% endif %}
        {% for docente in docentes %}
        <tr>
          <td>{{docente.id}}</td>
          <td>{{docente.nombres}}</td>
          <td>{{docente.apellidos}}</td>
          <td>{{docente.facultad}}</td>
          <td>{{docente.curso}}</td>
          <td>
            {% if docente.notaEvaluacion is not None %}
              {{ docente.notaEvaluacion }}
            {% else %}
              --
            {% endif %}
         </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="listar_docentes__botones">
    <form method="get" action="{% url 'exportar_pdf' %}">
      <input type="hidden" name="cod_curso" value="{{ request.GET.cod_curso }}">
      <button type="submit" class="button--primary">Exportar como PDF</button>
    </form>
    <form method="get" action="{% url 'exportar_excel' %}">
      <input type="hidden" name="cod_curso" value="{{ request.GET.cod_curso }}">
      <button type="submit" class="button--primary">Exportar como Excel</button>
    </form>
  </div>
</section>

<script>
  const inputVisible = document.getElementById("curso-input");
  const inputHidden = document.getElementById("cod_curso_real");
  const opciones = document.getElementById("cursos-list").options;

  inputVisible.addEventListener("input", () => {
    // Buscar si lo escrito está en la lista
    let encontrado = false;

    for (let i = 0; i < opciones.length; i++) {
      if (opciones[i].value === inputVisible.value) {
        inputHidden.value = opciones[i].dataset.codigo;
        encontrado = true;
        break;
      }
    }

    // Si no está en la lista, usar lo que el usuario escribió
    if (!encontrado) {
      inputHidden.value = inputVisible.value;
    }
  });

  // También actualizar el valor oculto al enviar
  document.querySelector("form").addEventListener("submit", () => {
    if (!inputHidden.value) {
      inputHidden.value = inputVisible.value;
    }
  });
</script>
{% endblock %}

